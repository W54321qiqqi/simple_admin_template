import{D as be,b as de,d as le,b8 as fe,au as ue,a as Q,cM as ce,cN as ke,cO as he,aY as ve,u as me,bI as Ie,l as y,cP as _e,aL as Le,c as b,L as oe,X as pe,m as ge,o as p,z as re,s as i,t as I,q as m,n as u,f as a,h as ie,aO as ze,g as _,aP as T,c6 as Ce,e as N,F as G,cr as Ee,b4 as Oe,cQ as Ne,cR as Se,a2 as Te,cS as xe,cT as $e,v as Re,aC as Ae,b6 as Ve,r as U,aR as Me,bK as Be,_ as we,aM as M,aT as V,cU as Ye,w as ye,a6 as Xe,cV as De,bw as H,a3 as Pe,ab as Fe,bH as He,I as We,cW as je,aN as Ze}from"./index-ae101c87.js";import{d as qe,i as Ke}from"./debounce-07a304c3.js";var Ue="Expected a function";function se(c,k,o){var s=!0,g=!0;if(typeof c!="function")throw new TypeError(Ue);return be(o)&&(s="leading"in o?!!o.leading:s,g="trailing"in o?!!o.trailing:g),qe(c,k,{leading:s,maxWait:k,trailing:g})}const Ge=de({urlList:{type:le(Array),default:()=>fe([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),Qe={close:()=>!0,switch:c=>ue(c)},Je=["src"],ea=Q({name:"ElImageViewer"}),aa=Q({...ea,props:Ge,emits:Qe,setup(c,{expose:k,emit:o}){const s=c,g={CONTAIN:{name:"contain",icon:ce(ke)},ORIGINAL:{name:"original",icon:ce(he)}},{t:L}=ve(),l=me("image-viewer"),{nextZIndex:J}=Ie(),x=y(),S=y([]),z=_e(),h=y(!0),d=y(s.initialIndex),f=Le(g.CONTAIN),r=y({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),B=b(()=>{const{urlList:e}=s;return e.length<=1}),$=b(()=>d.value===0),W=b(()=>d.value===s.urlList.length-1),ee=b(()=>s.urlList[d.value]),Y=b(()=>{const{scale:e,deg:t,offsetX:n,offsetY:v,enableTransition:E}=r.value;let w=n/e,O=v/e;switch(t%360){case 90:case-270:[w,O]=[O,-w];break;case 180:case-180:[w,O]=[-w,-O];break;case 270:case-90:[w,O]=[-O,w];break}const A={transform:`scale(${e}) rotate(${t}deg) translate(${w}px, ${O}px)`,transition:E?"transform .3s":""};return f.value.name===g.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),ae=b(()=>ue(s.zIndex)?s.zIndex:J());function R(){te(),o("close")}function X(){const e=se(n=>{switch(n.code){case V.esc:s.closeOnPressEscape&&R();break;case V.space:P();break;case V.left:q();break;case V.up:C("zoomIn");break;case V.right:K();break;case V.down:C("zoomOut");break}}),t=se(n=>{const v=n.deltaY||n.deltaX;C(v<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});z.run(()=>{M(document,"keydown",e),M(document,"wheel",t)})}function te(){z.stop()}function ne(){h.value=!1}function j(e){h.value=!1,e.target.alt=L("el.image.error")}function Z(e){if(h.value||e.button!==0||!x.value)return;r.value.enableTransition=!1;const{offsetX:t,offsetY:n}=r.value,v=e.pageX,E=e.pageY,w=se(A=>{r.value={...r.value,offsetX:t+A.pageX-v,offsetY:n+A.pageY-E}}),O=M(document,"mousemove",w);M(document,"mouseup",()=>{O()}),e.preventDefault()}function D(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function P(){if(h.value)return;const e=Ye(g),t=Object.values(g),n=f.value.name,E=(t.findIndex(w=>w.name===n)+1)%e.length;f.value=g[e[E]],D()}function F(e){const t=s.urlList.length;d.value=(e+t)%t}function q(){$.value&&!s.infinite||F(d.value-1)}function K(){W.value&&!s.infinite||F(d.value+1)}function C(e,t={}){if(h.value)return;const{zoomRate:n,rotateDeg:v,enableTransition:E}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...t};switch(e){case"zoomOut":r.value.scale>.2&&(r.value.scale=Number.parseFloat((r.value.scale/n).toFixed(3)));break;case"zoomIn":r.value.scale<7&&(r.value.scale=Number.parseFloat((r.value.scale*n).toFixed(3)));break;case"clockwise":r.value.deg+=v;break;case"anticlockwise":r.value.deg-=v;break}r.value.enableTransition=E}return oe(ee,()=>{pe(()=>{const e=S.value[0];e!=null&&e.complete||(h.value=!0)})}),oe(d,e=>{D(),o("switch",e)}),ge(()=>{var e,t;X(),(t=(e=x.value)==null?void 0:e.focus)==null||t.call(e)}),k({setActiveItem:F}),(e,t)=>(p(),re(Be,{to:"body",disabled:!e.teleported},[i(Me,{name:"viewer-fade",appear:""},{default:I(()=>[m("div",{ref_key:"wrapper",ref:x,tabindex:-1,class:u(a(l).e("wrapper")),style:ie({zIndex:a(ae)})},[m("div",{class:u(a(l).e("mask")),onClick:t[0]||(t[0]=ze(n=>e.hideOnClickModal&&R(),["self"]))},null,2),_(" CLOSE "),m("span",{class:u([a(l).e("btn"),a(l).e("close")]),onClick:R},[i(a(T),null,{default:I(()=>[i(a(Ce))]),_:1})],2),_(" ARROW "),a(B)?_("v-if",!0):(p(),N(G,{key:0},[m("span",{class:u([a(l).e("btn"),a(l).e("prev"),a(l).is("disabled",!e.infinite&&a($))]),onClick:q},[i(a(T),null,{default:I(()=>[i(a(Ee))]),_:1})],2),m("span",{class:u([a(l).e("btn"),a(l).e("next"),a(l).is("disabled",!e.infinite&&a(W))]),onClick:K},[i(a(T),null,{default:I(()=>[i(a(Oe))]),_:1})],2)],64)),_(" ACTIONS "),m("div",{class:u([a(l).e("btn"),a(l).e("actions")])},[m("div",{class:u(a(l).e("actions__inner"))},[i(a(T),{onClick:t[1]||(t[1]=n=>C("zoomOut"))},{default:I(()=>[i(a(Ne))]),_:1}),i(a(T),{onClick:t[2]||(t[2]=n=>C("zoomIn"))},{default:I(()=>[i(a(Se))]),_:1}),m("i",{class:u(a(l).e("actions__divider"))},null,2),i(a(T),{onClick:P},{default:I(()=>[(p(),re(Te(a(f).icon)))]),_:1}),m("i",{class:u(a(l).e("actions__divider"))},null,2),i(a(T),{onClick:t[3]||(t[3]=n=>C("anticlockwise"))},{default:I(()=>[i(a(xe))]),_:1}),i(a(T),{onClick:t[4]||(t[4]=n=>C("clockwise"))},{default:I(()=>[i(a($e))]),_:1})],2)],2),_(" CANVAS "),m("div",{class:u(a(l).e("canvas"))},[(p(!0),N(G,null,Re(e.urlList,(n,v)=>Ae((p(),N("img",{ref_for:!0,ref:E=>S.value[v]=E,key:n,src:n,style:ie(a(Y)),class:u(a(l).e("img")),onLoad:ne,onError:j,onMousedown:Z},null,46,Je)),[[Ve,v===d.value]])),128))],2),U(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var ta=we(aa,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const na=ye(ta),sa=de({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:le([String,Object])},previewSrcList:{type:le(Array),default:()=>fe([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),la={load:c=>c instanceof Event,error:c=>c instanceof Event,switch:c=>ue(c),close:()=>!0,show:()=>!0},oa=["src","loading"],ra={key:0},ia=Q({name:"ElImage",inheritAttrs:!1}),ua=Q({...ia,props:sa,emits:la,setup(c,{emit:k}){const o=c;let s="";const{t:g}=ve(),L=me("image"),l=Xe(),J=De(),x=y(),S=y(!1),z=y(!0),h=y(!1),d=y(),f=y(),r=H&&"loading"in HTMLImageElement.prototype;let B,$;const W=b(()=>l.style),ee=b(()=>{const{fit:e}=o;return H&&e?{objectFit:e}:{}}),Y=b(()=>{const{previewSrcList:e}=o;return Array.isArray(e)&&e.length>0}),ae=b(()=>{const{previewSrcList:e,initialIndex:t}=o;let n=t;return t>e.length-1&&(n=0),n}),R=b(()=>o.loading==="eager"?!1:!r&&o.loading==="lazy"||o.lazy),X=()=>{H&&(z.value=!0,S.value=!1,x.value=o.src)};function te(e){z.value=!1,S.value=!1,k("load",e)}function ne(e){z.value=!1,S.value=!0,k("error",e)}function j(){Ke(d.value,f.value)&&(X(),P())}const Z=Ze(j,200,!0);async function D(){var e;if(!H)return;await pe();const{scrollContainer:t}=o;He(t)?f.value=t:We(t)&&t!==""?f.value=(e=document.querySelector(t))!=null?e:void 0:d.value&&(f.value=je(d.value)),f.value&&(B=M(f,"scroll",Z),setTimeout(()=>j(),100))}function P(){!H||!f.value||!Z||(B==null||B(),f.value=void 0)}function F(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function q(){Y.value&&($=M("wheel",F,{passive:!1}),s=document.body.style.overflow,document.body.style.overflow="hidden",h.value=!0,k("show"))}function K(){$==null||$(),document.body.style.overflow=s,h.value=!1,k("close")}function C(e){k("switch",e)}return oe(()=>o.src,()=>{R.value?(z.value=!0,S.value=!1,P(),D()):X()}),ge(()=>{R.value?D():X()}),(e,t)=>(p(),N("div",{ref_key:"container",ref:d,class:u([a(L).b(),e.$attrs.class]),style:ie(a(W))},[S.value?U(e.$slots,"error",{key:0},()=>[m("div",{class:u(a(L).e("error"))},Pe(a(g)("el.image.error")),3)]):(p(),N(G,{key:1},[x.value!==void 0?(p(),N("img",Fe({key:0},a(J),{src:x.value,loading:e.loading,style:a(ee),class:[a(L).e("inner"),a(Y)&&a(L).e("preview"),z.value&&a(L).is("loading")],onClick:q,onLoad:te,onError:ne}),null,16,oa)):_("v-if",!0),z.value?(p(),N("div",{key:1,class:u(a(L).e("wrapper"))},[U(e.$slots,"placeholder",{},()=>[m("div",{class:u(a(L).e("placeholder"))},null,2)])],2)):_("v-if",!0)],64)),a(Y)?(p(),N(G,{key:2},[h.value?(p(),re(a(na),{key:0,"z-index":e.zIndex,"initial-index":a(ae),infinite:e.infinite,"zoom-rate":e.zoomRate,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:K,onSwitch:C},{default:I(()=>[e.$slots.viewer?(p(),N("div",ra,[U(e.$slots,"viewer")])):_("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):_("v-if",!0)],64)):_("v-if",!0)],6))}});var ca=we(ua,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const va=ye(ca);export{va as E};
